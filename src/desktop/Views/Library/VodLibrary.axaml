<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="SquadOV.Views.Library.VodLibrary">
  <DockPanel>
    <!-- Top toolbar -->
    <Panel
      Height="48"
      DockPanel.Dock="Top"
      Background="#252525">
      <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0">
        <!-- Search box -->
        <TextBox
          Name="SearchBox"
          Text="{Binding SearchText}"
          Watermark="Search VODs..."
          Width="200"
          Margin="0,0,10,0" />
        
        <!-- Action buttons -->
        <Button Content="Import VOD" Command="{Binding ImportVodCommand}" Margin="5,0" />
        <Button Content="Generate Sample Data" Command="{Binding GenerateSampleDataCommand}" Margin="5,0" />
        <Button Content="Refresh" Command="{Binding LoadVodsCommand}" Margin="5,0" />
      </StackPanel>
      
      <!-- Storage stats in top right -->
      <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="10,0">
        <TextBlock Text="{Binding StorageStats.TotalVods, StringFormat='VODs: {0}'}" Foreground="White" Margin="5,0" />
        <TextBlock Text="{Binding StorageStats.FavoriteVods, StringFormat='Favorites: {0}'}" Foreground="White" Margin="5,0" />
        <TextBlock Text="{Binding StorageStats.TotalSize, StringFormat='Size: {0:N0} bytes'}" Foreground="White" Margin="5,0" />
      </StackPanel>
    </Panel>

    <!-- Main content area -->
    <Grid>
      <!-- Loading overlay -->
      <Panel IsVisible="{Binding IsLoading}" Background="#80000000" ZIndex="100">
        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
          <TextBlock Text="Loading..." Foreground="White" FontSize="16" HorizontalAlignment="Center" />
        </StackPanel>
      </Panel>

      <!-- VOD list -->
      <ScrollViewer IsVisible="{Binding !IsLoading}">
        <!-- Show "No VODs" message when list is empty -->
        <TextBlock 
          VerticalAlignment="Center" 
          HorizontalAlignment="Center" 
          Text="{Binding Loc.NoVods}"
          IsVisible="{Binding !VodFiles.Count}" />
        
        <!-- VOD grid -->
        <ItemsControl Items="{Binding VodFiles}" IsVisible="{Binding VodFiles.Count}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel Orientation="Horizontal" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Border 
                Background="#333333" 
                CornerRadius="8" 
                Margin="10" 
                Padding="10" 
                Width="280" 
                Height="200">
                <StackPanel>
                  <!-- VOD title -->
                  <TextBlock 
                    Text="{Binding Metadata.Title}" 
                    FontWeight="Bold" 
                    FontSize="14" 
                    Foreground="White" 
                    TextWrapping="Wrap"
                    MaxHeight="40" />
                  
                  <!-- Game name -->
                  <TextBlock 
                    Text="{Binding Metadata.GameName}" 
                    Foreground="#CCCCCC" 
                    FontSize="12" 
                    Margin="0,5,0,0" />
                  
                  <!-- Duration and file size -->
                  <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                    <TextBlock 
                      Text="{Binding GetFormattedDuration()}" 
                      Foreground="#AAAAAA" 
                      FontSize="11" />
                    <TextBlock 
                      Text=" • " 
                      Foreground="#AAAAAA" 
                      FontSize="11" />
                    <TextBlock 
                      Text="{Binding GetFormattedFileSize()}" 
                      Foreground="#AAAAAA" 
                      FontSize="11" />
                  </StackPanel>
                  
                  <!-- Created date -->
                  <TextBlock 
                    Text="{Binding Metadata.CreatedAt, StringFormat='Created: {0:MM/dd/yyyy}'}" 
                    Foreground="#AAAAAA" 
                    FontSize="11" 
                    Margin="0,2,0,0" />
                  
                  <!-- Status indicators -->
                  <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                    <Border 
                      Background="Red" 
                      CornerRadius="3" 
                      Padding="4,2"
                      IsVisible="{Binding !Exists}">
                      <TextBlock Text="Missing" Foreground="White" FontSize="10" />
                    </Border>
                    <Border 
                      Background="Gold" 
                      CornerRadius="3" 
                      Padding="4,2"
                      Margin="5,0,0,0"
                      IsVisible="{Binding Metadata.IsFavorite}">
                      <TextBlock Text="★ Favorite" Foreground="Black" FontSize="10" />
                    </Border>
                  </StackPanel>
                  
                  <!-- Action buttons -->
                  <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <Button 
                      Content="{Binding Metadata.IsFavorite, Converter={StaticResource favoriteConverter}}"
                      Command="{Binding $parent[UserControl].DataContext.ToggleFavoriteCommand}"
                      CommandParameter="{Binding}"
                      Width="30"
                      Height="25"
                      Margin="0,0,5,0" />
                    <Button 
                      Content="Export" 
                      Command="{Binding $parent[UserControl].DataContext.ExportVodCommand}"
                      CommandParameter="{Binding}"
                      Width="50"
                      Height="25"
                      Margin="0,0,5,0" />
                    <Button 
                      Content="Share" 
                      Command="{Binding $parent[UserControl].DataContext.ShareVodCommand}"
                      CommandParameter="{Binding}"
                      Width="50"
                      Height="25"
                      Margin="0,0,5,0" />
                    <Button 
                      Content="Delete" 
                      Background="DarkRed"
                      Command="{Binding $parent[UserControl].DataContext.DeleteVodCommand}"
                      CommandParameter="{Binding}"
                      Width="50"
                      Height="25" />
                  </StackPanel>
                </StackPanel>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Grid>
  </DockPanel>
</UserControl>
